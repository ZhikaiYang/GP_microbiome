---
title: "Genomic Selection practice"
author: "Zhikai Yang"
date: "March 9th, 2022"
output: NULL
---


## Normalize the path:

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE) 
knitr::opts_knit$set(root.dir=normalizePath('../../')) 
```



###Visualization for public data
```{r}
library(data.table)
library(ggplot2)
library(agricolae)
library(ggpubr)

p_K10_all <- fread("largedata/prediction_accuracy_all_again.txt", data.table = F)
p_K10_normal = fread("largedata/prediction_accuracy_normal.txt",data.table = F)

p_K10 = rbind(p_K10_normal,p_K10_all)

dp <- ggplot(p_K10, aes(x=method, y=accuracy, fill=method)) + 
  geom_violin(trim=FALSE)+
  geom_boxplot(width=0.1, fill="white")+
  labs(title="Plot of Predication Accuracy by Methods",x="Method", y = "Predication Accuracy")
dp + theme_classic()

fsize =16
p <-ggplot(p_K10, aes(x=method, y=accuracy, fill=method)) +
  geom_boxplot(outlier.colour="black", outlier.shape=16, outlier.size=1, notch=FALSE) +
   xlab("Method") +
    ylab("Predication Accuracy") +
    ggtitle("Plot of Predication Accuracy by Method") +
    theme_classic() +
    labs(fill = "") +
    #scale_y_continuous(limits = c(-0.01, 1)) +
    #stat_compare_means(method = "t.test")+
    theme(plot.title = element_text(size=20, face = "bold"), 
          axis.text=element_text(size=16, face="bold"),
          strip.text.x = element_text(size = 16, face = "bold"),
          axis.title=element_text(size=fsize, face="bold"),
          axis.text.x = element_text(angle = 15, hjust=0.8),
          legend.position = "right", 
          legend.title = element_text(size=fsize, face="bold"),
          legend.text = element_text(size=fsize))

p

t.test(p_K10$accuracy[p_K10$method=="rrBLUP_less"], p_K10$accuracy[p_K10$method=="rrBLUP_less_geno_microbiome"])

```
###Visualization for jyanglab data
```{r}

p_K10 <- fread("largedata/prediction_accuracy_trait_Canopy_Coverage_date_12-Aug_jyang.txt", data.table = F)


dp <- ggplot(p_K10, aes(x=method, y=accuracy, fill=method)) + 
  geom_violin(trim=FALSE)+
  geom_boxplot(width=0.1, fill="white")+
  labs(title="Plot of Predication Accuracy by Methods",x="Method", y = "Predication Accuracy")
dp + theme_classic()

fsize =16
p <-ggplot(p_K10, aes(x=method, y=accuracy, fill=method)) +
  geom_boxplot(outlier.colour="black", outlier.shape=16, outlier.size=1, notch=FALSE) +
   xlab("Method") +
    ylab("Predication Accuracy") +
    ggtitle("Plot of Predication Accuracy by Method") +
    theme_classic() +
    labs(fill = "") +
    #scale_y_continuous(limits = c(-0.01, 1)) +
    #stat_compare_means(method = "t.test")+
    theme(plot.title = element_text(size=20, face = "bold"), 
          axis.text=element_text(size=16, face="bold"),
          strip.text.x = element_text(size = 16, face = "bold"),
          axis.title=element_text(size=fsize, face="bold"),
          axis.text.x = element_text(angle = 15, hjust=0.8),
          legend.position = "right", 
          legend.title = element_text(size=fsize, face="bold"),
          legend.text = element_text(size=fsize))

p

t.test(p_K10$accuracy[p_K10$method=="rrBLUP"], p_K10$accuracy[p_K10$method=="rrBLUP_geno_microbiome"])

```

```{r}
f <- list.files(path="largedata", pattern="prediction_accuracy_trait", full.names = T)

out <- data.frame()
for(i in 1:length(f)){
  tem <- fread(f[i], header=TRUE)
  tem$file <- f[i]
  out <- rbind(out, tem)
}

out$trait  <- gsub(".*trait_|_date.*", "", out$file)
out$date  <- gsub(".*_date_|_jyang.*", "", out$file)
out$date <- factor(out$date, levels = c( "6-Jul", "12-Aug", "14-Aug", "16-Aug", "20-Aug", "22-Aug", "23-Aug", "26-Aug", "30-Aug", "1-Sep", "3-Sep", "5-Sep"),
                    labels =c( "6-Jul", "12-Aug", "14-Aug", "16-Aug", "20-Aug", "22-Aug", "23-Aug", "26-Aug", "30-Aug", "1-Sep", "3-Sep", "5-Sep"))

id_pc = which(out$method == "rrBLUP_PC_microbiome")
out = out[-id_pc,]

fsize = 18
p <- ggboxplot(out, x = "date", y = "accuracy",
          color = "method", palette = "jco",
          add = "jitter")
p_date = p + stat_compare_means(aes(group = method), label = "p.signif")+
  xlab("Date") +
    ylab("Prediction Accuracy ") +
    ggtitle("") +
    theme_classic() +
    labs(fill = "") +
    scale_y_continuous(limits = c(-0.01, 1)) +
    theme(plot.title = element_text(size=20, face = "bold"), 
          axis.text=element_text(size=16, face="bold"),
          strip.text.x = element_text(size = 16, face = "bold"),
          axis.title=element_text(size=fsize, face="bold"),
          axis.text.x = element_text(angle = 15, hjust=0.8),
          legend.position = "top", 
          legend.title = element_text(size=fsize, face="bold"),
          legend.text = element_text(size=fsize))

pdf("graphs/prediction_accuracy_canopy_coverage_by_dates.pdf", width = 9, height= 6)
p_date
dev.off()

```

